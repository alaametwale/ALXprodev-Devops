#!/bin/bash

POKEMONS=("Bulbasaur" "Ivysaur" "Venusaur" "Charmander" "Charmeleon")
OUTPUT_DIR="pokemon_data"
mkdir -p $OUTPUT_DIR

fetch_pokemon() {
    local P=$1
    RETRIES=0
    SUCCESS=false
    while [ $RETRIES -lt 3 ]; do
        echo "Fetching data for $P..."
        if curl -s -f -o "$OUTPUT_DIR/${P,,}.json" "https://pokeapi.co/api/v2/pokemon/${P,,}"; then
            echo "Saved data to $OUTPUT_DIR/${P,,}.json ✅"
            SUCCESS=true
            break
        else
            echo "Failed to fetch $P. Retrying..."
            ((RETRIES++))
            sleep 2
        fi
    done
    if [ "$SUCCESS" = false ]; then
        echo "Failed to fetch $P after 3 attempts. Logging error."
        echo "Failed to fetch $P" >> errors.txt
    fi
}

# تشغيل كل بوكيمون في الخلفية
for P in "${POKEMONS[@]}"; do
    fetch_pokemon $P &
done

# التحقق من اكتمال كل العمليات الخلفية
while jobs %% >/dev/null 2>&1; do
    sleep 1
done

echo "All parallel fetches completed ✅"
